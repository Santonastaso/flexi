import{R as C,r,u as L,t as P,j as e,a as U,b as G,g as X,c as q,i as W}from"./index-CS8LlaBj.js";const Q=C.memo(({machine:t,hour:u,minute:l,isUnavailable:d,hasScheduledTask:v})=>{const{setNodeRef:i}=U({id:`slot-${t.id}-${u}-${l}`,data:{machine:t,hour:u,minute:l,type:"slot",isUnavailable:d,hasScheduledTask:v}}),c=`time-slot${d?" unavailable":""}${v?" has-scheduled-task":""}`;return e.jsx("div",{ref:i,className:c,"data-hour":u,"data-minute":l})}),J=C.memo(({event:t,machine:u,currentDate:l})=>{const[d,v]=r.useState(!0),[i,c]=r.useState(!1),p=L(s=>s.updateOdpOrder),{attributes:f,listeners:n,setNodeRef:x,transform:b,isDragging:g}=G({id:`event-${t.id}`,data:{event:t,type:"event",machine:u},disabled:d}),a=r.useMemo(()=>{const s=new Date(t.scheduled_start_time),o=t.time_remaining||t.duration||1,m=new Date(s.getTime()+o*60*60*1e3),S=X(l),D=q(l),N=W(s,l),z=W(m,l),H=s<D&&m>S;if(!N&&!z&&!H)return null;let j,$;if(N){const M=s.getHours(),T=s.getMinutes();j=(M*4+Math.floor(T/15))*20;const F=24-M;$=Math.min(o,F)*4*20}else if(z){j=0;const M=m.getHours(),T=m.getMinutes();$=(M*4+Math.ceil(T/15))*20}else j=0,$=1920;return{baseLeft:j,baseWidth:$,eventSpansCurrentDay:H,eventStartsOnCurrentDay:N,eventEndsOnCurrentDay:z}},[t.scheduled_start_time,t.time_remaining,t.duration,l]),h=r.useMemo(()=>{if(!a)return 22;const{baseWidth:s}=a,o=s<60,m=s<120;return o?18:m?20:22},[a]),w=r.useMemo(()=>{if(!a)return 5;const{baseWidth:s}=a,o=s<60,m=s<120;return o?3:m?4:5},[a]),y=r.useMemo(()=>{if(!a)return 13;const{baseWidth:s}=a,o=s<60,m=s<120;return o?11:m?12:13},[a]),_=r.useMemo(()=>{if(!a)return!1;const{baseWidth:s}=a;return s<60&&s<80},[a]),k=r.useMemo(()=>{if(!a)return!1;const{baseWidth:s}=a;return s<40},[a]),O=r.useMemo(()=>{if(!a)return{};const{baseLeft:s,baseWidth:o}=a;return g?{position:"absolute",left:`${s}px`,width:`${o}px`,transform:`translate3d(${b?.x||0}px, ${b?.y||0}px, 0)`,zIndex:1001,pointerEvents:"none",willChange:"transform",backfaceVisibility:"hidden",transition:"none",boxShadow:"none",opacity:.8,filter:"none",borderRadius:"4px",padding:"4px 6px",minHeight:"32px"}:{position:"absolute",left:`${s}px`,width:`${o}px`,transform:"none",zIndex:10,willChange:"auto",backfaceVisibility:"visible",opacity:1,transition:"opacity 0.1s ease"}},[a,g,b]),V=r.useCallback(s=>{s.stopPropagation(),v(!d)},[d]),E=r.useCallback(async s=>{if(!t.scheduled_start_time){console.log("Event is not scheduled yet, cannot move");return}if(!i){c(!0);try{const o=new Date(t.scheduled_start_time),m=900*1e3;let S;s==="back"?S=new Date(o.getTime()-m):S=new Date(o.getTime()+m);const D={scheduled_start_time:S.toISOString()};await p(t.id,D),console.log(`Event moved ${s} by 15 minutes`)}catch(o){console.error("Failed to move event:",o)}finally{c(!1)}}},[t.scheduled_start_time,t.id,i,p]);if(!a)return null;const{baseLeft:Y,baseWidth:Z,eventSpansCurrentDay:B,eventStartsOnCurrentDay:R,eventEndsOnCurrentDay:A}=a;return e.jsxs("div",{ref:x,style:O||{},className:`scheduled-event ${g?"dragging":""} ${B&&!R&&!A?"cross-day":""}`,children:[e.jsx("div",{className:"event-content",style:{opacity:g?.7:1,transform:g?"scale(0.95)":"none"},children:e.jsx("span",{className:"event-label",children:t.odp_number})}),!g&&e.jsxs("div",{className:`event-controls ${_?"overlay":""}`,style:{gap:`${w}px`,marginTop:`${w}px`,flexDirection:_?"column":"row",..._&&{left:"50%",transform:"translateX(-50%)",minWidth:k?"120px":"auto"}},children:[e.jsx("button",{className:"event-btn info-btn",title:`Delivery Date: ${t.delivery_date?new Date(t.delivery_date).toLocaleDateString():"Not set"}
Quantity: ${t.quantity||"Not specified"}
${t.scheduled_start_time?`Scheduled: ${new Date(t.scheduled_start_time).toLocaleString()}`:""}`,disabled:i,style:{width:`${h}px`,height:`${h}px`,fontSize:`${y}px`},children:e.jsx("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"})})}),e.jsx("button",{className:`event-btn lock-btn ${d?"locked":"unlocked"}`,onClick:V,title:d?"Unlock to enable dragging":"Lock to disable dragging",disabled:i,style:{width:`${h}px`,height:`${h}px`,fontSize:`${y}px`},children:d?e.jsx("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zM9 6c0-1.66 1.34-3 3-3s3 1.34 3 3v2H9V6z"})}):e.jsx("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M12 17c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm6-9h-1V6c0-2.76-2.24-5-5-5-2.28 0-4.27 1.54-4.84 3.75-.14.54.18 1.08.72 1.22.53.14 1.08-.18 1.22-.72C9.44 6.06 10.72 5 12 5c1.66 0 3 1.34 3 3v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2z"})})}),!d&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:`event-btn move-btn move-left ${i?"moving":""}`,onClick:s=>{s.stopPropagation(),E("back")},title:"Move back 15 minutes",disabled:i,style:{width:`${h}px`,height:`${h}px`,fontSize:`${y}px`},children:i?e.jsx("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm6 13h-5v5l-1.42-1.42L12.17 15H6v-2h6.17l-1.59-1.58L13 10l5 5z"})}):e.jsx("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L13.17 12z"})})}),e.jsx("button",{className:`event-btn move-btn move-right ${i?"moving":""}`,onClick:s=>{s.stopPropagation(),E("forward")},title:"Move forward 15 minutes",disabled:i,style:{width:`${h}px`,height:`${h}px`,fontSize:`${y}px`},children:i?e.jsx("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm6 13h-5v5l-1.42-1.42L12.17 15H6v-2h6.17l-1.59-1.58L13 10l5 5z"})}):e.jsx("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M8.59 16.59L10 18l6-6-6-6-1.41 1.41L13.17 12z"})})})]}),!d&&e.jsx("div",{className:"drag-handle",...n,...f,title:"Drag to reschedule",style:{width:`${h}px`,height:`${h}px`,fontSize:`${y+2}px`},children:e.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"})})})]})]})}),K=C.memo(({machine:t,scheduledEvents:u,currentDate:l,unavailableByMachine:d})=>{const v=r.useMemo(()=>u.filter(c=>c.scheduled_machine_id===t.id),[u,t.id]),i=d[t.id];return e.jsxs("div",{className:"machine-row","data-machine-id":t.id,children:[e.jsxs("div",{className:"machine-label",children:[e.jsx("div",{className:"machine-name",children:t.machine_name}),e.jsx("div",{className:"machine-city",children:t.work_center})]}),e.jsxs("div",{className:"machine-slots",children:[Array.from({length:96},(c,p)=>{const f=Math.floor(p/4),n=p%4*15,x=i?i.has(f.toString()):!1;return e.jsx(Q,{machine:t,hour:f,minute:n,isUnavailable:x,hasScheduledTask:!1},`${t.id}-${f}-${n}`)}),v.length>0&&v.map(c=>e.jsx(J,{event:c,machine:t,currentDate:l},`event-${c.id}`))]})]})}),ae=C.memo(({machines:t,tasks:u,currentDate:l})=>{const d=r.useMemo(()=>u.filter(n=>n.status==="SCHEDULED"),[u]),v=L(n=>n.loadMachineAvailabilityForDate),i=L(n=>n.machineAvailability),c=r.useMemo(()=>P(l),[l]);r.useEffect(()=>{v(c)},[c,v]);const p=r.useMemo(()=>{const n=i[c];if(!Array.isArray(n)||n.length===0)return{};const x={},b=performance.now();for(let a=0;a<n.length;a++){const h=n[a];h.machine_id&&h.unavailable_hours&&(x[h.machine_id]=new Set(h.unavailable_hours.map(w=>w.toString())))}const g=performance.now();return g-b>3&&console.log(`âš¡ Unavailable hours processing took: ${(g-b).toFixed(2)}ms`),x},[i,c]),f=r.useMemo(()=>Array.from({length:24},(n,x)=>e.jsx("div",{className:"time-slot-header hour-header",style:{gridColumn:`${x*4+1} / span 4`},children:x.toString().padStart(2,"0")},x)),[]);return!t||t.length===0?e.jsx("div",{className:"calendar-section",children:e.jsxs("div",{className:"empty-state",children:[e.jsx("h3",{children:"No machines available"}),e.jsx("p",{children:"Please add machines to view the schedule."})]})}):e.jsx("div",{className:"calendar-section",children:e.jsxs("div",{className:"calendar-grid",children:[e.jsxs("div",{className:"calendar-header-row",children:[e.jsx("div",{className:"machine-label-header",children:"Machines"}),e.jsx("div",{className:"time-header",children:f})]}),e.jsx("div",{className:"calendar-body",children:t.map(n=>e.jsx(K,{machine:n,scheduledEvents:d,currentDate:l,unavailableByMachine:p},n.id))})]})})});export{ae as default};
