import{R as j,r as o,e as A,t as B,j as e,a as I,b as G,c as P,d as U,g as X,f as q,i as _}from"./index-Alzlc9nK.js";const F=j.memo(({machine:t,hour:h,minute:i,isUnavailable:l,hasScheduledTask:m})=>{const{setNodeRef:f}=I({id:`slot-${t.id}-${h}-${i}`,data:{machine:t,hour:h,minute:i,type:"slot",isUnavailable:l,hasScheduledTask:m}}),d=`time-slot${l?" unavailable":""}${m?" has-scheduled-task":""}`;return e.jsx("div",{ref:f,className:d,"data-hour":h,"data-minute":i,"data-machine-id":t.id})}),Q=j.memo(({event:t,machine:h,currentDate:i})=>{const[l,m]=o.useState(!0),{updateOdpOrder:f}=G();P("GanttChart");const{attributes:d,listeners:v,setNodeRef:p,transform:n,isDragging:r}=U({id:`event-${t.id}`,data:{event:t,type:"event",machine:h},disabled:l}),s=o.useMemo(()=>{const a=new Date(t.scheduled_start_time),c=t.time_remaining||t.duration||1,x=new Date(a.getTime()+c*60*60*1e3),V=X(i),L=q(i),N=_(a,i),D=_(x,i),k=a<L&&x>V;if(!N&&!D&&!k)return null;let b,y;if(N){const S=a.getHours(),C=a.getMinutes();b=(S*4+Math.floor(C/15))*20;const R=24-S;y=Math.min(c,R)*4*20}else if(D){b=0;const S=x.getHours(),C=x.getMinutes();y=(S*4+Math.ceil(C/15))*20}else b=0,y=1920;return{baseLeft:b,baseWidth:y,eventSpansCurrentDay:k,eventStartsOnCurrentDay:N,eventEndsOnCurrentDay:D}},[t.scheduled_start_time,t.time_remaining,t.duration,i]),u=o.useMemo(()=>{if(!s)return 22;const{baseWidth:a}=s,c=a<60,x=a<120;return c?18:x?20:22},[s]),g=o.useMemo(()=>{if(!s)return 5;const{baseWidth:a}=s,c=a<60,x=a<120;return c?3:x?4:5},[s]),$=o.useMemo(()=>{if(!s)return 13;const{baseWidth:a}=s,c=a<60,x=a<120;return c?11:x?12:13},[s]),w=o.useMemo(()=>{if(!s)return!1;const{baseWidth:a}=s;return a<60&&a<80},[s]),M=o.useMemo(()=>{if(!s)return!1;const{baseWidth:a}=s;return a<40},[s]),T=o.useMemo(()=>{if(!s)return{};const{baseLeft:a,baseWidth:c}=s;return r?{position:"absolute",left:`${a}px`,width:`${c}px`,transform:`translate3d(${n?.x||0}px, ${n?.y||0}px, 0)`,zIndex:1001,pointerEvents:"none",willChange:"transform",backfaceVisibility:"hidden",transition:"none",boxShadow:"none",opacity:.8,filter:"none",borderRadius:"4px",padding:"4px 6px",minHeight:"32px"}:{position:"absolute",left:`${a}px`,width:`${c}px`,transform:"none",zIndex:10,willChange:"auto",backfaceVisibility:"visible",opacity:1,transition:"opacity 0.1s ease"}},[s,r,n]),z=o.useCallback(a=>{a.stopPropagation(),m(!l)},[l]);if(!s)return null;const{baseLeft:K,baseWidth:Y,eventSpansCurrentDay:E,eventStartsOnCurrentDay:W,eventEndsOnCurrentDay:H}=s;return e.jsxs("div",{ref:p,style:T||{},className:`scheduled-event ${r?"dragging":""} ${E&&!W&&!H?"cross-day":""}`,children:[e.jsx("div",{className:"event-content",style:{opacity:r?.7:1,transform:r?"scale(0.95)":"none"},children:e.jsx("span",{className:"event-label",children:t.odp_number})}),!r&&e.jsxs("div",{className:`event-controls ${w?"overlay":""}`,style:{gap:`${g}px`,marginTop:`${g}px`,flexDirection:w?"column":"row",...w&&{left:"50%",transform:"translateX(-50%)",minWidth:M?"120px":"auto"}},children:[e.jsx("button",{className:"event-btn info-btn",title:`Delivery Date: ${t.delivery_date?new Date(t.delivery_date).toLocaleDateString():"Not set"}
Quantity: ${t.quantity||"Not specified"}
${t.scheduled_start_time?`Scheduled: ${new Date(t.scheduled_start_time).toLocaleString()}`:""}`,style:{width:`${u}px`,height:`${u}px`,fontSize:`${$}px`},children:e.jsx("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"})})}),e.jsx("button",{className:`event-btn lock-btn ${l?"locked":"unlocked"}`,onClick:z,title:l?"Unlock to enable dragging":"Lock to disable dragging",style:{width:`${u}px`,height:`${u}px`,fontSize:`${$}px`},children:l?e.jsx("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zM9 6c0-1.66 1.34-3 3-3s3 1.34 3 3v2H9V6z"})}):e.jsx("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M12 17c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm6-9h-1V6c0-2.76-2.24-5-5-5-2.28 0-4.27 1.54-4.84 3.75-.14.54.18 1.08.72 1.22.53.14 1.08-.18 1.22-.72C9.44 6.06 10.72 5 12 5c1.66 0 3 1.34 3 3v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2z"})})}),!l&&e.jsx("div",{className:"drag-handle",...v,...d,title:"Drag to reschedule",style:{width:`${u}px`,height:`${u}px`,fontSize:`${$+2}px`},children:e.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"})})})]})]})}),J=j.memo(({machine:t,scheduledEvents:h,currentDate:i,unavailableByMachine:l})=>{const m=o.useMemo(()=>h.filter(d=>d.scheduled_machine_id===t.id),[h,t.id]),f=l[t.id];return e.jsxs("div",{className:"machine-row","data-machine-id":t.id,children:[e.jsxs("div",{className:"machine-label",children:[e.jsx("div",{className:"machine-name",children:t.machine_name}),e.jsx("div",{className:"machine-city",children:t.work_center})]}),e.jsxs("div",{className:"machine-slots",children:[Array.from({length:96},(d,v)=>{const p=Math.floor(v/4),n=v%4*15,r=f?f.has(p.toString()):!1;return e.jsx(F,{machine:t,hour:p,minute:n,isUnavailable:r,hasScheduledTask:!1},`${t.id}-${p}-${n}`)}),m.length>0&&m.map(d=>e.jsx(Q,{event:d,machine:t,currentDate:i},`event-${d.id}`))]})]})}),se=j.memo(({machines:t,tasks:h,currentDate:i})=>{const l=o.useMemo(()=>h.filter(n=>n.status==="SCHEDULED"),[h]),{loadMachineAvailabilityForDate:m,machineAvailability:f}=A(),d=o.useMemo(()=>B(i),[i]);o.useEffect(()=>(m(d),()=>{}),[d,m]);const v=o.useMemo(()=>{const n=f[d];if(!Array.isArray(n)||n.length===0)return{};const r={};performance.now();for(let s=0;s<n.length;s++){const u=n[s];u.machine_id&&u.unavailable_hours&&(r[u.machine_id]=new Set(u.unavailable_hours.map(g=>g.toString())))}return performance.now(),r},[f,d]),p=o.useMemo(()=>Array.from({length:24},(n,r)=>e.jsx("div",{className:"time-slot-header hour-header",style:{gridColumn:`${r*4+1} / span 4`},children:r.toString().padStart(2,"0")},r)),[]);return!t||t.length===0?e.jsx("div",{className:"calendar-section",children:e.jsxs("div",{className:"empty-state",children:[e.jsx("h3",{children:"No machines available"}),e.jsx("p",{children:"Please add machines to view the schedule."})]})}):e.jsx("div",{className:"calendar-section",children:e.jsxs("div",{className:"calendar-grid",children:[e.jsxs("div",{className:"calendar-header-row",children:[e.jsx("div",{className:"machine-label-header",children:"Machines"}),e.jsx("div",{className:"time-header",children:p})]}),e.jsx("div",{className:"calendar-body",children:t.map(n=>e.jsx(J,{machine:n,scheduledEvents:l,currentDate:i,unavailableByMachine:v},n.id))})]})})});export{se as default};
