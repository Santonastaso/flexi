import{R as D,r as c,u as O,t as q,j as e,a as Q,b as J,g as K,c as Y,i as A}from"./index-D-2PAvgj.js";const Z=D.memo(({machine:t,hour:r,minute:i,isUnavailable:o,hasScheduledTask:d})=>{const{setNodeRef:s}=Q({id:`slot-${t.id}-${r}-${i}`,data:{machine:t,hour:r,minute:i,type:"slot",isUnavailable:o,hasScheduledTask:d}}),l=`time-slot${o?" unavailable":""}${d?" has-scheduled-task":""}`;return e.jsx("div",{ref:s,className:l,"data-hour":r,"data-minute":i})}),ee=D.memo(({event:t,machine:r,currentDate:i})=>{const[o,d]=c.useState(!0),[s,l]=c.useState(!1),u=O(n=>n.updateOdpOrder),{attributes:b,listeners:a,setNodeRef:h,transform:S,isDragging:v}=J({id:`event-${t.id}`,data:{event:t,type:"event",machine:r},disabled:o}),y=c.useMemo(()=>{const n=new Date(t.scheduled_start_time),p=t.time_remaining||t.duration||1,f=new Date(n.getTime()+p*60*60*1e3),j=K(i),E=Y(i),L=A(n,i),T=A(f,i),R=n<E&&f>j;if(!L&&!T&&!R)return null;let C,M;if(L){const _=n.getHours(),H=n.getMinutes();C=(_*4+Math.floor(H/15))*20;const X=24-_;M=Math.min(p,X)*4*20}else if(T){C=0;const _=f.getHours(),H=f.getMinutes();M=(_*4+Math.ceil(H/15))*20}else C=0,M=1920;return{baseLeft:C,baseWidth:M,eventSpansCurrentDay:R,eventStartsOnCurrentDay:L,eventEndsOnCurrentDay:T}},[t.scheduled_start_time,t.time_remaining,t.duration,i]);if(!y)return null;const{baseLeft:g,baseWidth:x,eventSpansCurrentDay:I,eventStartsOnCurrentDay:F,eventEndsOnCurrentDay:P}=y,$=x<60,N=x<120,m=$?18:N?20:22,B=$?3:N?4:5,w=$?11:N?12:13,z=$&&x<80,k=x<40,W=v?{position:"absolute",left:`${g}px`,width:`${x}px`,transform:`translate3d(${S?.x||0}px, ${S?.y||0}px, 0)`,zIndex:1001,pointerEvents:"none",willChange:"transform",backfaceVisibility:"hidden",transition:"none",boxShadow:"none",opacity:.8,filter:"none",borderRadius:"4px",padding:"4px 6px",minHeight:"32px"}:{position:"absolute",left:`${g}px`,width:`${x}px`,transform:"none",zIndex:10,willChange:"auto",backfaceVisibility:"visible",opacity:1,transition:"opacity 0.1s ease"},U=c.useCallback(n=>{n.stopPropagation(),d(!o)},[o]),V=c.useCallback(async n=>{if(!t.scheduled_start_time){console.log("Event is not scheduled yet, cannot move");return}if(!s){l(!0);try{const p=new Date(t.scheduled_start_time),f=900*1e3;let j;n==="back"?j=new Date(p.getTime()-f):j=new Date(p.getTime()+f);const E={scheduled_start_time:j.toISOString()};await u(t.id,E),console.log(`Event moved ${n} by 15 minutes`)}catch(p){console.error("Failed to move event:",p)}finally{l(!1)}}},[t.scheduled_start_time,t.id,s,u]);return e.jsxs("div",{ref:h,style:W,className:`scheduled-event ${v?"dragging":""} ${I&&!F&&!P?"cross-day":""}`,children:[e.jsx("div",{className:"event-content",style:{opacity:v?.7:1,transform:v?"scale(0.95)":"none"},children:e.jsx("span",{className:"event-label",children:t.odp_number})}),!v&&e.jsxs("div",{className:`event-controls ${z?"overlay":""}`,style:{gap:`${B}px`,marginTop:`${B}px`,flexDirection:z?"column":"row",...z&&{left:"50%",transform:"translateX(-50%)",minWidth:k?"120px":"auto"}},children:[e.jsx("button",{className:"event-btn info-btn",title:`Delivery Date: ${t.delivery_date?new Date(t.delivery_date).toLocaleDateString():"Not set"}
Quantity: ${t.quantity||"Not specified"}
${t.scheduled_start_time?`Scheduled: ${new Date(t.scheduled_start_time).toLocaleString()}`:""}`,disabled:s,style:{width:`${m}px`,height:`${m}px`,fontSize:`${w}px`},children:e.jsx("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"})})}),e.jsx("button",{className:`event-btn lock-btn ${o?"locked":"unlocked"}`,onClick:U,title:o?"Unlock to enable dragging":"Lock to disable dragging",disabled:s,style:{width:`${m}px`,height:`${m}px`,fontSize:`${w}px`},children:o?e.jsx("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zM9 6c0-1.66 1.34-3 3-3s3 1.34 3 3v2H9V6z"})}):e.jsx("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M12 17c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm6-9h-1V6c0-2.76-2.24-5-5-5-2.28 0-4.27 1.54-4.84 3.75-.14.54.18 1.08.72 1.22.53.14 1.08-.18 1.22-.72C9.44 6.06 10.72 5 12 5c1.66 0 3 1.34 3 3v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2z"})})}),!o&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:`event-btn move-btn move-left ${s?"moving":""}`,onClick:n=>{n.stopPropagation(),V("back")},title:"Move back 15 minutes",disabled:s,style:{width:`${m}px`,height:`${m}px`,fontSize:`${w}px`},children:s?e.jsx("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm6 13h-5v5l-1.42-1.42L12.17 15H6v-2h6.17l-1.59-1.58L13 10l5 5z"})}):e.jsx("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L13.17 12z"})})}),e.jsx("button",{className:`event-btn move-btn move-right ${s?"moving":""}`,onClick:n=>{n.stopPropagation(),V("forward")},title:"Move forward 15 minutes",disabled:s,style:{width:`${m}px`,height:`${m}px`,fontSize:`${w}px`},children:s?e.jsx("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm6 13h-5v5l-1.42-1.42L12.17 15H6v-2h6.17l-1.59-1.58L13 10l5 5z"})}):e.jsx("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M8.59 16.59L10 18l6-6-6-6-1.41 1.41L13.17 12z"})})})]}),!o&&e.jsx("div",{className:"drag-handle",...a,...b,title:"Drag to reschedule",style:{width:`${m}px`,height:`${m}px`,fontSize:`${w+2}px`},children:e.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"})})})]})]})}),te=D.memo(({machine:t,scheduledEvents:r,currentDate:i,unavailableByMachine:o})=>{const d=c.useMemo(()=>r.filter(l=>l.scheduled_machine_id===t.id),[r,t.id]),s=o[t.id];return e.jsxs("div",{className:"machine-row","data-machine-id":t.id,children:[e.jsxs("div",{className:"machine-label",children:[e.jsx("div",{className:"machine-name",children:t.machine_name}),e.jsx("div",{className:"machine-city",children:t.work_center})]}),e.jsxs("div",{className:"machine-slots",children:[Array.from({length:96},(l,u)=>{const b=Math.floor(u/4),a=u%4*15,h=s?s.has(b.toString()):!1;return e.jsx(Z,{machine:t,hour:b,minute:a,isUnavailable:h,hasScheduledTask:!1},`${u}`)}),d.length>0&&d.map(l=>e.jsx(ee,{event:l,machine:t,currentDate:i},`event-${l.id}`))]})]})}),ie=D.memo(({machines:t,tasks:r,currentDate:i})=>{const o=c.useMemo(()=>r.filter(a=>a.status==="SCHEDULED"),[r]),d=O(a=>a.loadMachineAvailabilityForDate),s=O(a=>a.machineAvailability),l=c.useMemo(()=>q(i),[i]);c.useEffect(()=>{d(l)},[l,d]);const u=c.useMemo(()=>{const a=s[l];if(!Array.isArray(a)||a.length===0)return{};const h={},S=performance.now();for(let y=0;y<a.length;y++){const g=a[y];g.machine_id&&g.unavailable_hours&&(h[g.machine_id]=new Set(g.unavailable_hours.map(x=>x.toString())))}const v=performance.now();return v-S>3&&console.log(`âš¡ Unavailable hours processing took: ${(v-S).toFixed(2)}ms`),h},[s,l]),b=c.useMemo(()=>Array.from({length:24},(a,h)=>e.jsx("div",{className:"time-slot-header hour-header",style:{gridColumn:`${h*4+1} / span 4`},children:h.toString().padStart(2,"0")},h)),[]);return!t||t.length===0?e.jsx("div",{className:"calendar-section",children:e.jsxs("div",{className:"empty-state",children:[e.jsx("h3",{children:"No machines available"}),e.jsx("p",{children:"Please add machines to view the schedule."})]})}):e.jsx("div",{className:"calendar-section",children:e.jsxs("div",{className:"calendar-grid",children:[e.jsxs("div",{className:"calendar-header-row",children:[e.jsx("div",{className:"machine-label-header",children:"Machines"}),e.jsx("div",{className:"time-header",children:b})]}),e.jsx("div",{className:"calendar-body",children:t.map(a=>e.jsx(te,{machine:a,scheduledEvents:o,currentDate:i,unavailableByMachine:u},a.id))})]})})});export{ie as default};
