import{u as b,a as D,b as $,c as E,d as A,r as u,j as a,D as M,e as P,f as R,g as h}from"./index-CbN07Q5y.js";const K=({task:o,schedulingLoading:n})=>{b();const{attributes:s,listeners:l,setNodeRef:c}=P({id:`task-${o.id}`,data:{task:o,type:"task"},disabled:!1}),d=n.taskId===o.id&&(n.isScheduling||n.isRescheduling||n.isShunting);return a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("button",{className:"inline-flex items-center justify-center w-6 h-6 text-xs font-bold text-gray-600 bg-gray-100 rounded hover:bg-gray-200 transition-colors",onClick:r=>{r.stopPropagation(),r.preventDefault()},onMouseDown:r=>{r.stopPropagation(),r.preventDefault()},onPointerDown:r=>{r.stopPropagation(),r.preventDefault()},title:`Codice Articolo: ${o.article_code||"Non specificato"}
Codice Articolo Esterno: ${o.external_article_code||"Non specificato"}
Nome Cliente: ${o.nome_cliente||"Non specificato"}
Data Consegna: ${o.delivery_date?R(new Date(o.delivery_date),"yyyy-MM-dd"):"Non impostata"}
Quantità: ${o.quantity||"Non specificata"}
Note Libere: ${o.user_notes||"Nessuna nota"}
Note ASD: ${o.asd_notes||"Nessuna nota"}
Material Global: ${o.material_availability_global||"N/A"}%
${o.scheduled_start_time?`Inizio Programmato: ${h(o.scheduled_start_time)}`:"Non programmato"}
${o.scheduled_end_time?`Fine Programmata: ${h(o.scheduled_end_time)}`:"Non programmato"}`,children:"i"}),a.jsx("div",{ref:c,className:"drag-handle",...l,...s,title:"Trascina per programmare",style:{background:"#f3f4f6",border:"1px solid #d1d5db",minWidth:"30px",minHeight:"30px",display:"flex",alignItems:"center",justifyContent:"center",cursor:"grab",borderRadius:"4px",transition:"all 0.2s ease"},onMouseEnter:r=>{r.target.style.background="#e5e7eb",r.target.style.borderColor="#9ca3af"},onMouseLeave:r=>{r.target.style.background="#f3f4f6",r.target.style.borderColor="#d1d5db"},onClick:r=>{r.stopPropagation()},onMouseDown:r=>{r.stopPropagation()},children:a.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"currentColor",children:a.jsx("path",{d:"M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"})})}),d&&a.jsx("div",{className:"inline-flex items-center justify-center w-6 h-6",children:a.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-blue-600"})})]})};function z({filterByCost:o=!0}){const n=b(),{selectedWorkCenter:s,conflictDialog:l,schedulingLoading:c,showConfirmDialog:d}=D(),{setNodeRef:r}=$({id:"task-pool",data:{type:"pool"}}),{data:f=[],isLoading:y,error:x,refetch:m}=E(),v=A();u.useEffect(()=>{const t=()=>{m()};return window.addEventListener("focus",t),()=>{window.removeEventListener("focus",t)}},[m]);const g=f,p=u.useMemo(()=>{let t=g.filter(e=>{const i=e.status!=="SCHEDULED",w=e.duration>0,C=o?e.cost>0:!0;return i&&w&&C});return s&&s!=="BOTH"&&(t=t.filter(e=>e.work_center===s)),t},[g,s,o]),_=u.useMemo(()=>[{header:"ODP",accessorKey:"odp_number"},{header:"Codice Articolo",accessorKey:"article_code"},{header:"Nome Cliente",accessorKey:"nome_cliente"},{header:"Quantità",accessorKey:"quantity"},{header:"Quantità Completata",accessorKey:"quantity_completed"},{header:"Durata (h)",accessorKey:"duration",cell:({row:t})=>{const e=t.original.duration;return e?Number(e).toFixed(1):"N/A"}},{header:"Costo (€)",accessorKey:"cost",cell:({row:t})=>{const e=t.original.cost;return e?Number(e).toFixed(2):"N/A"}},{header:"Material ISP (%)",accessorKey:"material_availability_isp",cell:({row:t})=>{const e=t.original.material_availability_isp;if(typeof e!="number")return e||"N/A";const i=e<=39?"bg-gray-300":e<=69?"bg-yellow-400":"bg-green-400";return a.jsx("div",{className:`inline-flex items-center justify-center w-8 h-8 rounded-full ${i} text-black text-[10px] font-medium`,children:e})}},{header:"Material Lotti (%)",accessorKey:"material_availability_lotti",cell:({row:t})=>{const e=t.original.material_availability_lotti;if(typeof e!="number")return e||"N/A";const i=e<=39?"bg-gray-300":e<=69?"bg-yellow-400":"bg-green-400";return a.jsx("div",{className:`inline-flex items-center justify-center w-8 h-8 rounded-full ${i} text-black text-[10px] font-medium`,children:e})}},{header:"Material Global (%)",accessorKey:"material_availability_global",cell:({row:t})=>{const e=t.original.material_availability_global;if(typeof e!="number")return e||"N/A";const i=e<=39?"bg-gray-300":e<=69?"bg-yellow-400":"bg-green-400";return a.jsx("div",{className:`inline-flex items-center justify-center w-8 h-8 rounded-full ${i} text-black text-[10px] font-medium`,children:e})}},{header:"Note ASD",accessorKey:"asd_notes",cell:({row:t})=>{const e=t.original.asd_notes;return e?a.jsx("div",{className:"max-w-[200px] truncate text-[10px]",title:e,children:e}):"N/A"}},{header:"Gantt",id:"gantt_actions",cell:({row:t})=>a.jsx(K,{task:t.original,schedulingLoading:c,conflictDialog:l})}],[c,l]),N=t=>{!t||!t.id||n(`/backlog/${t.id}/edit`)},j=async t=>{d("Elimina Ordine",`Sei sicuro di voler eliminare "${t.odp_number}"? Questa azione non può essere annullata.`,async()=>{try{await v.mutateAsync(t.id),showSuccess(`Ordine "${t.odp_number}" eliminato con successo`)}catch(e){showError(e.message||"Eliminazione ordine fallita")}},"danger")};return a.jsx("div",{ref:r,id:"task_pool",className:"task-pool-table-container",children:y?a.jsxs("div",{className:"empty-state",children:[a.jsx("h3",{children:"Caricamento..."}),a.jsx("p",{children:"Recupero dati dal server..."})]}):x?a.jsxs("div",{className:"empty-state",children:[a.jsx("h3",{children:"Errore nel caricamento"}),a.jsx("p",{children:"Impossibile caricare i dati. Riprova più tardi."})]}):p.length>0?a.jsx(M,{data:p,columns:_,onEditRow:N,onDeleteRow:j,enableFiltering:!0,filterableColumns:["odp_number","article_code","nome_cliente"]}):a.jsxs("div",{className:"empty-state",children:[a.jsx("h3",{children:"Nessun lavoro non programmato disponibile"}),a.jsx("p",{children:"I lavori devono avere durata e costo maggiori di 0 per essere visualizzati qui."})]})})}export{z as default};
