import{u as v,a as E,b as x,c as O,d as $,e as T,f as b,r as l,j as e,D as P,g as R,h as z}from"./index-DYYdorlp.js";const A=({task:a,isEditMode:s,schedulingLoading:i,conflictDialog:d})=>{v();const{updateOdpOrder:u}=x();b("TaskPoolDataTable");const{attributes:m,listeners:p}=R({id:`task-${a.id}`,data:{task:a,type:"task"},disabled:!s}),c=i.taskId===a.id&&(i.isScheduling||i.isRescheduling||i.isShunting);return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"inline-flex items-center justify-center w-6 h-6 text-xs font-bold text-gray-600 bg-gray-100 rounded hover:bg-gray-200 transition-colors",onClick:o=>{o.stopPropagation(),o.preventDefault()},onMouseDown:o=>{o.stopPropagation(),o.preventDefault()},onPointerDown:o=>{o.stopPropagation(),o.preventDefault()},title:`Codice Articolo: ${a.article_code||"Non specificato"}
Codice Articolo Esterno: ${a.external_article_code||"Non specificato"}
Nome Cliente: ${a.nome_cliente||"Non specificato"}
Data Consegna: ${a.delivery_date?z(new Date(a.delivery_date),"yyyy-MM-dd"):"Non impostata"}
Quantità: ${a.quantity||"Non specificata"}
Note Libere: ${a.user_notes||"Nessuna nota"}
${a.scheduled_start_time?`Inizio Programmato: ${a.scheduled_start_time.replace("+00:00","")}`:"Non programmato"}
${a.scheduled_end_time?`Fine Programmata: ${a.scheduled_end_time.replace("+00:00","")}`:"Non programmato"}`,children:"i"}),s&&e.jsx("div",{className:"inline-flex items-center justify-center w-6 h-6 text-gray-600 bg-gray-100 rounded hover:bg-gray-200 transition-colors cursor-grab active:cursor-grabbing",...p,...m,title:"Trascina per programmare",children:e.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"})})}),c&&e.jsx("div",{className:"inline-flex items-center justify-center w-6 h-6",children:e.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-blue-600"})})]})};function H(){const a=v(),{selectedWorkCenter:s,isEditMode:i,conflictDialog:d,schedulingLoading:u,showConfirmDialog:m}=E(),{odpOrders:p,setOdpOrders:c}=x(),{setNodeRef:o}=O({id:"task-pool",data:{type:"pool"}}),{data:n=[],isLoading:y,error:N,refetch:h}=$(),_=T(),{handleAsync:j}=b("TaskPoolDataTable");l.useEffect(()=>{n.length>0&&c(n)},[n,c]),l.useEffect(()=>{const t=()=>{h()};return window.addEventListener("focus",t),()=>{window.removeEventListener("focus",t)}},[h]);const g=n.length>0?n:p,f=l.useMemo(()=>{let t=g.filter(r=>r.status!=="SCHEDULED"&&r.duration>0&&r.cost>0);return s&&s!=="BOTH"&&(t=t.filter(r=>r.work_center===s)),t},[g,s]),D=l.useMemo(()=>[{header:"ODP",accessorKey:"odp_number"},{header:"Codice Articolo",accessorKey:"article_code"},{header:"Nome Cliente",accessorKey:"nome_cliente"},{header:"Durata (h)",accessorKey:"duration",cell:({row:t})=>{const r=t.original.duration;return r?Number(r).toFixed(1):"N/A"}},{header:"Costo (€)",accessorKey:"cost",cell:({row:t})=>{const r=t.original.cost;return r?Number(r).toFixed(2):"N/A"}},{header:"Gantt",id:"gantt_actions",cell:({row:t})=>e.jsx(A,{task:t.original,isEditMode:i,schedulingLoading:u,conflictDialog:d})}],[i,u,d]),w=t=>{a(`/backlog/${t.id}/edit`)},C=async t=>{m("Elimina Ordine",`Sei sicuro di voler eliminare "${t.odp_number}"? Questa azione non può essere annullata.`,async()=>{await j(async()=>{await _.mutateAsync(t.id)},{context:"Delete Order",fallbackMessage:"Eliminazione ordine fallita"})},"danger")};return e.jsx("div",{ref:o,id:"task_pool",className:"task-pool-table-container",children:y?e.jsxs("div",{className:"empty-state",children:[e.jsx("h3",{children:"Caricamento..."}),e.jsx("p",{children:"Recupero dati dal server..."})]}):N?e.jsxs("div",{className:"empty-state",children:[e.jsx("h3",{children:"Errore nel caricamento"}),e.jsx("p",{children:"Impossibile caricare i dati. Riprova più tardi."})]}):f.length>0?e.jsx(P,{data:f,columns:D,onEditRow:w,onDeleteRow:C,enableFiltering:!0,filterableColumns:["odp_number","article_code","nome_cliente"]}):e.jsxs("div",{className:"empty-state",children:[e.jsx("h3",{children:"Nessun lavoro non programmato disponibile"}),e.jsx("p",{children:"I lavori devono avere durata e costo maggiori di 0 per essere visualizzati qui."})]})})}export{H as default};
