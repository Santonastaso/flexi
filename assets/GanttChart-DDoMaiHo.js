import{R as j,r as u,u as _,t as R,j as t,a as H,b as k,g as L,c as F,i as C}from"./index-DHOGONNm.js";const I=j.memo(({machine:e,hour:i,minute:a,isUnavailable:d,hasScheduledTask:o})=>{const{setNodeRef:l}=H({id:`slot-${e.id}-${i}-${a}`,data:{machine:e,hour:i,minute:a,type:"slot",isUnavailable:d,hasScheduledTask:o}}),n=`time-slot${d?" unavailable":""}${o?" has-scheduled-task":""}`;return t.jsx("div",{ref:l,className:n,"data-hour":i,"data-minute":a})}),W=j.memo(({event:e,machine:i,currentDate:a})=>{const{attributes:d,listeners:o,setNodeRef:l,transform:n,isDragging:c}=k({id:`event-${e.id}`,data:{event:e,type:"event",machine:i}}),m=u.useMemo(()=>{const h=new Date(e.scheduled_start_time),M=e.time_remaining||e.duration||1,x=new Date(h.getTime()+M*60*60*1e3),E=L(a),T=F(a),D=C(h,a),N=C(x,a),$=h<T&&x>E;if(!D&&!N&&!$)return null;let p,b;if(D){const S=h.getHours(),w=h.getMinutes();p=(S*4+Math.floor(w/15))*20;const O=24-S;b=Math.min(M,O)*4*20}else if(N){p=0;const S=x.getHours(),w=x.getMinutes();b=(S*4+Math.ceil(w/15))*20}else p=0,b=1920;return{baseLeft:p,baseWidth:b,eventSpansCurrentDay:$,eventStartsOnCurrentDay:D,eventEndsOnCurrentDay:N}},[e.scheduled_start_time,e.time_remaining,e.duration,a]);if(!m)return null;const{baseLeft:s,baseWidth:r,eventSpansCurrentDay:g,eventStartsOnCurrentDay:y,eventEndsOnCurrentDay:v}=m,f=c?{position:"absolute",left:`${s}px`,width:`${r}px`,transform:`translate3d(${n?.x||0}px, ${n?.y||0}px, 0)`,zIndex:1001,pointerEvents:"none",willChange:"transform",backfaceVisibility:"hidden",transition:"none"}:{position:"absolute",left:`${s}px`,width:`${r}px`,transform:"none",zIndex:10,willChange:"transform",backfaceVisibility:"hidden"};return t.jsx("div",{ref:l,style:f,...o,...d,className:`scheduled-event ${c?"dragging":""} ${g&&!y&&!v?"cross-day":""}`,children:t.jsx("span",{className:"event-label",children:e.odp_number})})}),z=j.memo(({machine:e,scheduledEvents:i,currentDate:a,unavailableByMachine:d})=>{const o=u.useMemo(()=>i.filter(n=>n.scheduled_machine_id===e.id),[i,e.id]),l=d[e.id];return t.jsxs("div",{className:"machine-row","data-machine-id":e.id,children:[t.jsxs("div",{className:"machine-label",children:[t.jsx("div",{className:"machine-name",children:e.machine_name}),t.jsx("div",{className:"machine-city",children:e.work_center})]}),t.jsxs("div",{className:"machine-slots",children:[Array.from({length:96},(n,c)=>{const m=Math.floor(c/4),s=c%4*15,r=l?l.has(m.toString()):!1;return t.jsx(I,{machine:e,hour:m,minute:s,isUnavailable:r,hasScheduledTask:!1},`${c}`)}),o.length>0&&o.map(n=>t.jsx(W,{event:n,machine:e,currentDate:a},`event-${n.id}`))]})]})}),B=j.memo(({machines:e,tasks:i,currentDate:a})=>{const d=u.useMemo(()=>i.filter(s=>s.status==="SCHEDULED"),[i]),o=_(s=>s.loadMachineAvailabilityForDate),l=_(s=>s.machineAvailability),n=u.useMemo(()=>R(a),[a]);u.useEffect(()=>{o(n)},[n,o]);const c=u.useMemo(()=>{const s=l[n];if(!Array.isArray(s)||s.length===0)return{};const r={},g=performance.now();for(let v=0;v<s.length;v++){const f=s[v];f.machine_id&&f.unavailable_hours&&(r[f.machine_id]=new Set(f.unavailable_hours.map(h=>h.toString())))}const y=performance.now();return y-g>3&&console.log(`âš¡ Unavailable hours processing took: ${(y-g).toFixed(2)}ms`),r},[l,n]),m=u.useMemo(()=>Array.from({length:24},(s,r)=>t.jsx("div",{className:"time-slot-header hour-header",style:{gridColumn:`${r*4+1} / span 4`},children:r.toString().padStart(2,"0")},r)),[]);return!e||e.length===0?t.jsx("div",{className:"calendar-section",children:t.jsxs("div",{className:"empty-state",children:[t.jsx("h3",{children:"No machines available"}),t.jsx("p",{children:"Please add machines to view the schedule."})]})}):t.jsx("div",{className:"calendar-section",children:t.jsxs("div",{className:"calendar-grid",children:[t.jsxs("div",{className:"calendar-header-row",children:[t.jsx("div",{className:"machine-label-header",children:"Machines"}),t.jsx("div",{className:"time-header",children:m})]}),t.jsx("div",{className:"calendar-body",children:e.map(s=>t.jsx(z,{machine:s,scheduledEvents:d,currentDate:a,unavailableByMachine:c},s.id))})]})})});export{B as default};
