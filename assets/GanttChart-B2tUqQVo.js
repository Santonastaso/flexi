import{R as j,a as _,r as h,e as A,t as B,j as e,b as I,c as P,d as G,g as U,f as q,i as M}from"./index-BzfSvXH_.js";const F=j.memo(({machine:t,hour:l,minute:n,isUnavailable:i,hasScheduledTask:d})=>{const{setNodeRef:m}=I({id:`slot-${t.id}-${l}-${n}`,data:{machine:t,hour:l,minute:n,type:"slot",isUnavailable:i,hasScheduledTask:d}}),r=`time-slot${i?" unavailable":""}${d?" has-scheduled-task":""}`;return e.jsx("div",{ref:m,className:r,"data-hour":l,"data-minute":n,"data-machine-id":t.id})}),Q=j.memo(({event:t,machine:l,currentDate:n})=>{const[i,d]=h.useState(!0),{updateOdpOrder:m}=_();P("GanttChart");const{attributes:r,listeners:x,setNodeRef:v,transform:s,isDragging:a}=G({id:`event-${t.id}`,data:{event:t,type:"event",machine:l},disabled:i}),o=h.useMemo(()=>{const c=new Date(t.scheduled_start_time),g=t.time_remaining||t.duration||1,p=new Date(c.getTime()+g*60*60*1e3),T=U(n),V=q(n),w=M(c,n),N=M(p,n),D=c<V&&p>T;if(!w&&!N&&!D)return null;let b,y;if(w){const S=c.getHours(),$=c.getMinutes();b=(S*4+Math.floor($/15))*20;const W=24-S;y=Math.min(g,W)*4*20}else if(N){b=0;const S=p.getHours(),$=p.getMinutes();y=(S*4+Math.ceil($/15))*20}else b=0,y=1920;return{baseLeft:b,baseWidth:y,eventSpansCurrentDay:D,eventStartsOnCurrentDay:w,eventEndsOnCurrentDay:N}},[t.scheduled_start_time,t.time_remaining,t.duration,n]),u=o?.baseWidth<60,f=o?.baseWidth<120,k=u&&o?.baseWidth<80,C=o?.baseWidth<40,E=h.useMemo(()=>{if(!o)return{};const{baseLeft:c,baseWidth:g}=o;return a?{position:"absolute",left:`${c}px`,width:`${g}px`,transform:`translate3d(${s?.x||0}px, ${s?.y||0}px, 0)`,zIndex:1001,pointerEvents:"none",willChange:"transform",backfaceVisibility:"hidden",transition:"none",boxShadow:"none",opacity:.8,filter:"none",borderRadius:"4px",padding:"4px 6px",minHeight:"32px"}:{position:"absolute",left:`${c}px`,width:`${g}px`,transform:"none",zIndex:10,willChange:"auto",backfaceVisibility:"visible",opacity:1,transition:"opacity 0.1s ease"}},[o,a,s,f,u,C]),H=h.useCallback(c=>{c.stopPropagation(),d(!i)},[i]);if(!o)return null;const{baseLeft:K,baseWidth:X,eventSpansCurrentDay:O,eventStartsOnCurrentDay:z,eventEndsOnCurrentDay:L}=o;return e.jsxs("div",{ref:v,style:E||{},className:`scheduled-event ${a?"dragging":""} ${O&&!z&&!L?"cross-day":""} ${u?"very-small":""} ${f?"small":""} ${C?"extremely-narrow":""}`,children:[e.jsx("div",{className:"event-content",style:{opacity:a?.7:1,transform:a?"scale(0.95)":"none"},children:e.jsx("span",{className:"event-label",children:t.odp_number})}),!a&&e.jsxs("div",{className:`event-controls ${k?"overlay":""}`,children:[e.jsx("button",{className:"event-btn info-btn",title:`Delivery Date: ${t.delivery_date?new Date(t.delivery_date).toLocaleDateString():"Not set"}
Quantity: ${t.quantity||"Not specified"}
${t.scheduled_start_time?`Scheduled: ${new Date(t.scheduled_start_time).toLocaleString()}`:""}`,children:e.jsx("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"})})}),e.jsx("button",{className:`event-btn lock-btn ${i?"locked":"unlocked"}`,onClick:H,title:i?"Unlock to enable dragging":"Lock to disable dragging",children:i?e.jsx("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zM9 6c0-1.66 1.34-3 3-3s3 1.34 3 3v2H9V6z"})}):e.jsx("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M12 17c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm6-9h-1V6c0-2.76-2.24-5-5-5-2.28 0-4.27 1.54-4.84 3.75-.14.54.18 1.08.72 1.22.53.14 1.08-.18 1.22-.72C9.44 6.06 10.72 5 12 5c1.66 0 3 1.34 3 3v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2z"})})}),!i&&e.jsx("div",{className:"drag-handle",...x,...r,title:"Drag to reschedule",children:e.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"})})})]})]})}),J=j.memo(({machine:t,scheduledEvents:l,currentDate:n,unavailableByMachine:i})=>{const d=h.useMemo(()=>l.filter(r=>r.scheduled_machine_id===t.id),[l,t.id]),m=i[t.id];return e.jsxs("div",{className:"machine-row","data-machine-id":t.id,children:[e.jsxs("div",{className:"machine-label",children:[e.jsx("div",{className:"machine-name",children:t.machine_name}),e.jsx("div",{className:"machine-city",children:t.work_center})]}),e.jsxs("div",{className:"machine-slots",children:[Array.from({length:96},(r,x)=>{const v=Math.floor(x/4),s=x%4*15,a=m?m.has(v.toString()):!1;return e.jsx(F,{machine:t,hour:v,minute:s,isUnavailable:a,hasScheduledTask:!1},`${t.id}-${v}-${s}`)}),d.length>0&&d.map(r=>e.jsx(Q,{event:r,machine:t,currentDate:n},`event-${r.id}`))]})]})}),te=j.memo(({machines:t,currentDate:l})=>{const{odpOrders:n}=_(),i=h.useMemo(()=>n.filter(s=>s.status==="SCHEDULED"),[n]),{loadMachineAvailabilityForDate:d,machineAvailability:m}=A(),r=h.useMemo(()=>B(l),[l]);h.useEffect(()=>(d(r),()=>{}),[r,d]);const x=h.useMemo(()=>{const s=m[r];if(!Array.isArray(s)||s.length===0)return{};const a={};performance.now();for(let o=0;o<s.length;o++){const u=s[o];u.machine_id&&u.unavailable_hours&&(a[u.machine_id]=new Set(u.unavailable_hours.map(f=>f.toString())))}return performance.now(),a},[m,r]),v=h.useMemo(()=>Array.from({length:24},(s,a)=>e.jsx("div",{className:"time-slot-header hour-header",style:{gridColumn:`${a*4+1} / span 4`},children:a.toString().padStart(2,"0")},a)),[]);return!t||t.length===0?e.jsx("div",{className:"calendar-section",children:e.jsx("div",{className:"calendar-grid-container",children:e.jsxs("div",{className:"empty-state",children:[e.jsx("h3",{children:"No machines available"}),e.jsx("p",{children:"Please add machines to view the schedule."})]})})}):e.jsx("div",{className:"calendar-section",children:e.jsx("div",{className:"calendar-grid-container",children:e.jsxs("div",{className:"calendar-grid",children:[e.jsxs("div",{className:"calendar-header-row",children:[e.jsx("div",{className:"machine-label-header",children:"Machines"}),e.jsx("div",{className:"time-header",children:v})]}),e.jsx("div",{className:"calendar-body",children:t.map(s=>e.jsx(J,{machine:s,scheduledEvents:i,currentDate:l,unavailableByMachine:x},s.id))})]})})})});export{te as default};
