import{u as b,a as E,b as x,c as O,d as P,e as $,f as v,r as d,j as o,D as R,g as T,h as M}from"./index--9ZGc_Lz.js";const z=({task:a,isEditMode:s,schedulingLoading:n,conflictDialog:l})=>{b();const{updateOdpOrder:c}=x();v("TaskPoolDataTable");const{attributes:u,listeners:m,setNodeRef:i}=T({id:`task-${a.id}`,data:{task:a,type:"task"},disabled:!s}),p=n.taskId===a.id&&(n.isScheduling||n.isRescheduling||n.isShunting);return o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("button",{className:"inline-flex items-center justify-center w-6 h-6 text-xs font-bold text-gray-600 bg-gray-100 rounded hover:bg-gray-200 transition-colors",onClick:e=>{e.stopPropagation(),e.preventDefault()},onMouseDown:e=>{e.stopPropagation(),e.preventDefault()},onPointerDown:e=>{e.stopPropagation(),e.preventDefault()},title:`Codice Articolo: ${a.article_code||"Non specificato"}
Codice Articolo Esterno: ${a.external_article_code||"Non specificato"}
Nome Cliente: ${a.nome_cliente||"Non specificato"}
Data Consegna: ${a.delivery_date?M(new Date(a.delivery_date),"yyyy-MM-dd"):"Non impostata"}
Quantità: ${a.quantity||"Non specificata"}
Note Libere: ${a.user_notes||"Nessuna nota"}
${a.scheduled_start_time?`Inizio Programmato: ${a.scheduled_start_time.replace("+00:00","")}`:"Non programmato"}
${a.scheduled_end_time?`Fine Programmata: ${a.scheduled_end_time.replace("+00:00","")}`:"Non programmato"}`,children:"i"}),s&&o.jsx("div",{ref:i,className:"drag-handle",...m,...u,title:"Trascina per programmare",style:{background:"#f3f4f6",border:"1px solid #d1d5db",minWidth:"30px",minHeight:"30px",display:"flex",alignItems:"center",justifyContent:"center",cursor:"grab",borderRadius:"4px",transition:"all 0.2s ease"},onMouseEnter:e=>{e.target.style.background="#e5e7eb",e.target.style.borderColor="#9ca3af"},onMouseLeave:e=>{e.target.style.background="#f3f4f6",e.target.style.borderColor="#d1d5db"},onClick:e=>{e.stopPropagation()},onMouseDown:e=>{e.stopPropagation()},children:o.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"currentColor",children:o.jsx("path",{d:"M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"})})}),p&&o.jsx("div",{className:"inline-flex items-center justify-center w-6 h-6",children:o.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-blue-600"})})]})};function H(){const a=b(),{selectedWorkCenter:s,isEditMode:n,conflictDialog:l,schedulingLoading:c,showConfirmDialog:u}=E(),{odpOrders:m,setOdpOrders:i}=x(),{setNodeRef:p}=O({id:"task-pool",data:{type:"pool"}}),{data:e=[],isLoading:y,error:N,refetch:h}=P(),_=$(),{handleAsync:j}=v("TaskPoolDataTable");d.useEffect(()=>{e.length>0&&i(e)},[e,i]),d.useEffect(()=>{const t=()=>{h()};return window.addEventListener("focus",t),()=>{window.removeEventListener("focus",t)}},[h]);const g=e.length>0?e:m,f=d.useMemo(()=>{let t=g.filter(r=>r.status!=="SCHEDULED"&&r.duration>0&&r.cost>0);return s&&s!=="BOTH"&&(t=t.filter(r=>r.work_center===s)),t},[g,s]),D=d.useMemo(()=>[{header:"ODP",accessorKey:"odp_number"},{header:"Codice Articolo",accessorKey:"article_code"},{header:"Nome Cliente",accessorKey:"nome_cliente"},{header:"Durata (h)",accessorKey:"duration",cell:({row:t})=>{const r=t.original.duration;return r?Number(r).toFixed(1):"N/A"}},{header:"Costo (€)",accessorKey:"cost",cell:({row:t})=>{const r=t.original.cost;return r?Number(r).toFixed(2):"N/A"}},{header:"Gantt",id:"gantt_actions",cell:({row:t})=>o.jsx(z,{task:t.original,isEditMode:n,schedulingLoading:c,conflictDialog:l})}],[n,c,l]),w=t=>{if(!t||!t.id){console.error("Invalid task data for editing:",t);return}a(`/backlog/${t.id}/edit`)},C=async t=>{u("Elimina Ordine",`Sei sicuro di voler eliminare "${t.odp_number}"? Questa azione non può essere annullata.`,async()=>{await j(async()=>{await _.mutateAsync(t.id)},{context:"Delete Order",fallbackMessage:"Eliminazione ordine fallita"})},"danger")};return o.jsx("div",{ref:p,id:"task_pool",className:"task-pool-table-container",children:y?o.jsxs("div",{className:"empty-state",children:[o.jsx("h3",{children:"Caricamento..."}),o.jsx("p",{children:"Recupero dati dal server..."})]}):N?o.jsxs("div",{className:"empty-state",children:[o.jsx("h3",{children:"Errore nel caricamento"}),o.jsx("p",{children:"Impossibile caricare i dati. Riprova più tardi."})]}):f.length>0?o.jsx(R,{data:f,columns:D,onEditRow:w,onDeleteRow:C,enableFiltering:!0,filterableColumns:["odp_number","article_code","nome_cliente"]}):o.jsxs("div",{className:"empty-state",children:[o.jsx("h3",{children:"Nessun lavoro non programmato disponibile"}),o.jsx("p",{children:"I lavori devono avere durata e costo maggiori di 0 per essere visualizzati qui."})]})})}export{H as default};
