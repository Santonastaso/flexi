import{R as j,r as m,u as $,t as O,j as s,a as R,b as L,g as k,c as F,i as w}from"./index-NNC3oNSr.js";const I=j.memo(({machine:e,hour:o,minute:a,isUnavailable:d,hasScheduledTask:i})=>{const{setNodeRef:l}=R({id:`slot-${e.id}-${o}-${a}`,data:{machine:e,hour:o,minute:a,type:"slot",isUnavailable:d,hasScheduledTask:i}}),n=`time-slot${d?" unavailable":""}${i?" has-scheduled-task":""}`;return s.jsx("div",{ref:l,className:n,"data-hour":o,"data-minute":a})}),W=j.memo(({event:e,machine:o,currentDate:a})=>{const{attributes:d,listeners:i,setNodeRef:l,transform:n,isDragging:c}=L({id:`event-${e.id}`,data:{event:e,type:"event",machine:o}}),h=m.useMemo(()=>{const v=new Date(e.scheduled_start_time),y=new Date(e.scheduled_end_time),E=e.duration||1,C=k(a),T=F(a),D=w(v,a),N=w(y,a),_=v<T&&y>C;if(!D&&!N&&!_)return null;let g,S;if(D){const b=v.getHours(),M=v.getMinutes();g=(b*4+Math.floor(M/15))*20;const H=24-b;S=Math.min(E,H)*4*20}else if(N){g=0;const b=y.getHours(),M=y.getMinutes();S=(b*4+Math.ceil(M/15))*20}else g=0,S=1920;return{baseLeft:g,baseWidth:S,eventSpansCurrentDay:_,eventStartsOnCurrentDay:D,eventEndsOnCurrentDay:N}},[e.scheduled_start_time,e.scheduled_end_time,e.duration,a]);if(!h)return null;const{baseLeft:t,baseWidth:r,eventSpansCurrentDay:x,eventStartsOnCurrentDay:p,eventEndsOnCurrentDay:f}=h,u=c?{position:"absolute",left:`${t}px`,width:`${r}px`,transform:`translate3d(${n?.x||0}px, ${n?.y||0}px, 0)`,zIndex:1001,pointerEvents:"none"}:{position:"absolute",left:`${t}px`,width:`${r}px`,transform:"none",zIndex:10};return s.jsx("div",{ref:l,style:u,...i,...d,className:`scheduled-event ${c?"dragging":""} ${x&&!p&&!f?"cross-day":""}`,children:s.jsx("span",{className:"event-label",children:e.odp_number})})}),z=j.memo(({machine:e,scheduledEvents:o,currentDate:a,unavailableByMachine:d})=>{const i=m.useMemo(()=>o.filter(n=>n.scheduled_machine_id===e.id),[o,e.id]),l=d[e.id];return s.jsxs("div",{className:"machine-row","data-machine-id":e.id,children:[s.jsxs("div",{className:"machine-label",children:[s.jsx("div",{className:"machine-name",children:e.machine_name}),s.jsx("div",{className:"machine-city",children:e.work_center})]}),s.jsxs("div",{className:"machine-slots",children:[Array.from({length:96},(n,c)=>{const h=Math.floor(c/4),t=c%4*15,r=l?l.has(h.toString()):!1;return s.jsx(I,{machine:e,hour:h,minute:t,isUnavailable:r,hasScheduledTask:!1},`${c}`)}),i.length>0&&i.map(n=>s.jsx(W,{event:n,machine:e,currentDate:a},`event-${n.id}`))]})]})}),G=j.memo(({machines:e,tasks:o,currentDate:a})=>{const d=m.useMemo(()=>o.filter(t=>t.status==="SCHEDULED"),[o]),i=$(t=>t.loadMachineAvailabilityForDate),l=$(t=>t.machineAvailability),n=m.useMemo(()=>O(a),[a]);m.useEffect(()=>{i(n)},[n,i]);const c=m.useMemo(()=>{const t=l[n];if(!Array.isArray(t)||t.length===0)return{};const r={},x=performance.now();for(let f=0;f<t.length;f++){const u=t[f];u.machine_id&&u.unavailable_hours&&(r[u.machine_id]=new Set(u.unavailable_hours.map(v=>v.toString())))}const p=performance.now();return p-x>3&&console.log(`âš¡ Unavailable hours processing took: ${(p-x).toFixed(2)}ms`),r},[l,n]),h=m.useMemo(()=>Array.from({length:24},(t,r)=>s.jsx("div",{className:"time-slot-header hour-header",style:{gridColumn:`${r*4+1} / span 4`},children:r.toString().padStart(2,"0")},r)),[]);return!e||e.length===0?s.jsx("div",{className:"calendar-section",children:s.jsxs("div",{className:"empty-state",children:[s.jsx("h3",{children:"No machines available"}),s.jsx("p",{children:"Please add machines to view the schedule."})]})}):s.jsx("div",{className:"calendar-section",children:s.jsxs("div",{className:"calendar-grid",children:[s.jsxs("div",{className:"calendar-header-row",children:[s.jsx("div",{className:"machine-label-header",children:"Machines"}),s.jsx("div",{className:"time-header",children:h})]}),s.jsx("div",{className:"calendar-body",children:e.map(t=>s.jsx(z,{machine:t,scheduledEvents:d,currentDate:a,unavailableByMachine:c},t.id))})]})})});export{G as default};
